<html>
<head>
    <meta charset="utf-8">
    <link href='https://fonts.googleapis.com/css?family=Tangerine:700' rel='stylesheet' type='text/css'>
    <title>What's That Song? An interactive guessing game made for Professor Loukissas's LMC 2700 Class</title>
    <style>
        * { 
            padding: 0;
            margin: 0;
        }
        canvas {
            background-image: url('https://hdwallpapers.cat/wallpaper_1600x900/vintage_music_paper_firefox_persona_score_1600x900_hd-wallpaper-630445.jpg');
            display: block;
            margin: 0;
            auto;
        }
    </style>
</head>
<body>
    <canvas id="board"></canvas>
    <script>
        /* What's That Song? An interactive guessing game made for Professor Loukissas's LMC 2700 Class
         * Team 5
         * Christine St. Jean (concept builder), Corey Salmon (affect architect), Zach Guthrie (craft engineer)
         * Commented out are our create your own features, which we could not fully implement due to technical limitations of replaying recorded notes.
         */

        var canvas;
        var surface;
        var startScreen;
        var trainingScreen;
        var improvScreen;
        var improvResultsScreen;
        var settingScreen;
        var gameScreen;
        var pianoScreen;
        var mainScreen;
        var continueScreen;
        var infoScreen;
        var listenScreen;
        var countdownScreen;
        var guessScreen;
        // var creationScreen;
        // var playbackScreen;
        var recordResultsScreen;
        var nextScreen;
        var winnerScreen;
        var numPlayers;
        var correctNotes = 0;
        var incorrectNotes = 0;
        var extraNotes = 0;
        var currentPlayer = 0;
        var players = [{idNum: 1, score: 0}];
        var currentSong;
        var improvRecord;
        var songs = [];
        var notes = [];
        var timeFrames = [];
        var currentNote = null;
        var transcripts = {odeToJoy: ['6868707171706883', '65658368688383', '838368658368706865'],
            twinkleStar: ['65657171727271', '70706868838365', '71717070686883'],
            // NOTE: sugar requires top two notes.
            sugar: ['79857985', '6970186808079798079', '7068878787697069878787'],
            callMeMaybe: ['8965698969', '6965697589', '8975797589'],
            notGonnaTakeIt: ['707065707165', '72707171728570', '727271707172707070'],
            clockTown: ['83767974727471', '727168727168717284', '83838387836872'],
            1812: ['83717274727172747171', '83717274727172747171', '687274726865687268656872'],
            frereJacques: ['6583686565836865', '687071687071', '717271706865717271706865'],
            // NOTE: hotlineBling requires top two notes.
            hotlineBling: ['767675222186767518675', '22218676751867572', '75757272757576'],
            takeOnMe: ['717169656570707072728575', '858585708371717170707170', '69698365'],
            numberOftheBeast: ['8383838483718372838372838372838372838372', '8383838483718372838372838372838372837272',
                '6565656865706571656571656571656571656571'],
            mario: ['68686865687171', '75716872747289', '656871727071686583'],
            marriageofFigaro: ['877089797585', '8979758589797585', '8984706987'],
            popGoesWeasel: ['6565838368716865', '656583706865', '7283706865'],
            shutUpandDance: ['7070757572717070', '7084707071727071', '7070757276757572717070'],
            wannabe: ['7171717171727168', '65836583836568', '757574717271'],
            thunderstruck: ['6865716568657165686571656865716568657165686571656865716568657165',
                '7065896570658965706589657065896570658965706589657065896570658965',
                '7565746572657465726571657265706571656865706568657065686570656865'],
            tetris: ['718369706983656569717069', '83697071696565', '70897585897169717069']
        };
        var songTitles = ['odeToJoy', 'twinkleStar', 'sugar', 'callMeMaybe', 'notGonnaTakeIt', 'clockTown',
            '1812', 'frereJacques', 'hotlineBling', 'takeOnMe', 'numberOftheBeast', 'mario',
            'marriageofFigaro', 'popGoesWeasel', 'shutUpandDance', 'wannabe', 'thunderstruck', 'tetris'];         
        var sounds = {
            65: 'bottomC',
            87: 'dFlat',
            83: 'D',
            69: 'eFlat',
            68: 'E',
            70: 'F',
            84: 'gFlat',
            71: 'G',
            89: 'aFlat',
            72: 'A',
            85: 'bFlat',
            74: 'B',
            75: 'topC',
            79: 'upperDflat',
            76: 'upperD',
            80: 'upperEflat',
            186: 'upperE',
            222: 'upperF'
        };
        var recordRound = 0;
        var guess = '';
        var title = 'What\'s that song?';
        var improvRound = 0;
        // var firstRecording = '';
        // var secondRecording = '';
        var chosen = [];
        for (var i = 0; i < 18; i++) {
            chosen[i] = false;
        }

        function beginLoop() {
            var frameId = 0;
            var lastFrame = Date.now();

            function loop() {
                var thisFrame = Date.now();

                var elapsed = thisFrame - lastFrame;

                frameId = window.requestAnimationFrame(loop);

                startScreen.update(canvas, elapsed);
                startScreen.draw(canvas, surface);

                lastFrame = thisFrame;
            }

            loop();
        }

        canvas = document.querySelector('canvas#board');
        canvas.setAttribute('width', 1200);
        canvas.setAttribute('height', 900);

        surface = canvas.getContext('2d');

        mouseClick = (function (target) {
            var isButtonDown = false;

            target.addEventListener('mousedown', function () {
                isButtonDown = true;
            });
            target.addEventListener('mouseup', function () {
                isButtonDown = false;
            });

            return {
                isButtonDown: function () {
                    return isButtonDown;
                }
            };
        }(document));

        function centerText(ctx, text, y) {
            var measurement = ctx.measureText(text);
            var x = (ctx.canvas.width - measurement.width) / 2;
            ctx.fillText(text, x, y);
            ctx.strokeText(text, x, y);
        }

        function buttonCollision(buttons, x, y) {
            var isCollision = false;
            for (var i = 0; i < buttons.length; i++) {
                var left = buttons[i].x;
                var right = buttons[i].x + buttons[i].w;
                var top = buttons[i].y
                var bottom = buttons[i].y + buttons[i].h;
                if (right >= x && left <= x && bottom >= y && top <= y) {
                    isCollision = buttons[i];
                }
            }
            return isCollision;
        }

        function labelKeys(ctx) {
            ctx.font = '66px Tangerine';
            ctx.fillStyle = 'black';

            var measure = ctx.measureText('A');
            ctx.fillText('A', 150 - (measure.width / 2), 650);
            ctx.strokeText('A', 150 - (measure.width / 2), 650);

            measure = ctx.measureText('S');
            ctx.fillText('S', 240 - (measure.width / 2), 650);
            ctx.strokeText('S', 240 - (measure.width / 2), 650);

            measure = ctx.measureText('D');
            ctx.fillText('D', 330 - (measure.width / 2), 650);
            ctx.strokeText('D', 330 - (measure.width / 2), 650);

            measure = ctx.measureText('F');
            ctx.fillText('F', 420 - (measure.width / 2), 650);
            ctx.strokeText('F', 420 - (measure.width / 2), 650);

            measure = ctx.measureText('G');
            ctx.fillText('G', 510 - (measure.width / 2), 650);
            ctx.strokeText('G', 510 - (measure.width / 2), 650);

            measure = ctx.measureText('H');
            ctx.fillText('H', 600 - (measure.width / 2), 650);
            ctx.strokeText('H', 600 - (measure.width / 2), 650);

            measure = ctx.measureText('J');
            ctx.fillText('J', 690 - (measure.width / 2), 650);
            ctx.strokeText('J', 690 - (measure.width / 2), 650);

            measure = ctx.measureText('K');
            ctx.fillText('K', 780 - (measure.width / 2), 650);
            ctx.strokeText('K', 780 - (measure.width / 2), 650);

            measure = ctx.measureText('L');
            ctx.fillText('L', 870 - (measure.width / 2), 650);
            ctx.strokeText('L', 870 - (measure.width / 2), 650);

            measure = ctx.measureText(';');
            ctx.fillText(';', 960 - (measure.width / 2), 650);
            ctx.strokeText(';', 960 - (measure.width / 2), 650);
                
            measure = ctx.measureText(',');
            ctx.fillText(',', 1050 - (measure.width / 2), 650);
            ctx.strokeText(',', 1050 - (measure.width / 2), 650);
                
            ctx.fillStyle = 'white';
            ctx.font = '54px Tangerine';
            measure = ctx.measureText('Y');
            ctx.fillText('Y', 552 - (measure.width / 2), 250);
            ctx.strokeText('Y', 552 - (measure.width / 2), 250);

            ctx.font = '60px Tangerine';
            measure = ctx.measureText('W');
            ctx.fillText('W', 187 - (measure.width / 2), 250);
            ctx.strokeText('W', 187 - (measure.width / 2), 250);
                
            measure = ctx.measureText('E');
            ctx.fillText('E', 292 - (measure.width / 2), 250);
            ctx.strokeText('E', 292 - (measure.width / 2), 250);
                
            measure = ctx.measureText('T');
            ctx.fillText('T', 452 - (measure.width / 2), 250);
            ctx.strokeText('T', 452 - (measure.width / 2), 250);

            measure = ctx.measureText('U');
            ctx.fillText('U', 652 - (measure.width / 2), 250);
            ctx.strokeText('U', 652 - (measure.width / 2), 250);

            measure = ctx.measureText('O');
            ctx.fillText('O', 817 - (measure.width / 2), 250);
            ctx.strokeText('O', 817 - (measure.width / 2), 250);

            measure = ctx.measureText('P');
            ctx.fillText('P', 922 - (measure.width / 2), 250);
            ctx.strokeText('P', 922 - (measure.width / 2), 250);
        }

        function drawKeys(ctx) {
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            // Bottom C
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(105, 150);
            ctx.lineTo(105, 750);
            ctx.lineTo(195, 750);
            ctx.lineTo(195, 450);
            ctx.lineTo(150, 450);
            ctx.lineTo(150, 150);
            ctx.lineTo(105, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'bottomC') {
                ctx.fillStyle = '#b22937';
            }
            ctx.stroke();
            ctx.fill();

            // Lower D
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(225, 150);
            ctx.lineTo(255, 150);
            ctx.lineTo(255, 450);
            ctx.lineTo(285, 450);
            ctx.lineTo(285, 750);
            ctx.lineTo(195, 750);
            ctx.lineTo(195, 450);
            ctx.lineTo(225, 450);
            ctx.lineTo(225, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'D') {
                ctx.fillStyle = '#de5003';
            }
            ctx.stroke();
            ctx.fill();
                
            // Lower E
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(330, 150);
            ctx.lineTo(375, 150);
            ctx.lineTo(375, 750);
            ctx.lineTo(285, 750);
            ctx.lineTo(285, 450);
            ctx.lineTo(330, 450);
            ctx.lineTo(330, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'E') {
                ctx.fillStyle = '#efce10';
            }
            ctx.stroke();
            ctx.fill();

            // Lower F
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(375, 150);
            ctx.lineTo(375, 750);
            ctx.lineTo(465, 750);
            ctx.lineTo(465, 450);
            ctx.lineTo(420, 450);
            ctx.lineTo(420, 150);
            ctx.lineTo(375, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'F') {
                ctx.fillStyle = '#acd62a';
            }
            ctx.stroke();
            ctx.fill();
            // G

            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(495, 150);
            ctx.lineTo(525, 150);
            ctx.lineTo(525, 450);
            ctx.lineTo(555, 450);
            ctx.lineTo(555, 750);
            ctx.lineTo(465, 750);
            ctx.lineTo(465, 450);
            ctx.lineTo(495, 450);
            ctx.lineTo(495, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'G') {
                ctx.fillStyle = '#228b22';
            }
            ctx.stroke();
            ctx.fill();

            // A
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(585, 150);
            ctx.lineTo(615, 150);
            ctx.lineTo(615, 450);
            ctx.lineTo(645, 450);
            ctx.lineTo(645, 750);
            ctx.lineTo(555, 750);
            ctx.lineTo(555, 450);
            ctx.lineTo(585, 450);
            ctx.lineTo(585, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'A') {
                ctx.fillStyle = '#93bde7';
            }
            ctx.stroke();
            ctx.fill();

            // B
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(690, 150);
            ctx.lineTo(735, 150);
            ctx.lineTo(735, 750);
            ctx.lineTo(645, 750);
            ctx.lineTo(645, 450);
            ctx.lineTo(690, 450);
            ctx.lineTo(690, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'B') {
                ctx.fillStyle = '#575597';
            }
            ctx.stroke();
            ctx.fill();

            // Top C
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(735, 150);
            ctx.lineTo(735, 750);
            ctx.lineTo(825, 750);
            ctx.lineTo(825, 450);
            ctx.lineTo(780, 450);
            ctx.lineTo(780, 150);
            ctx.lineTo(735, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'topC') {
                ctx.fillStyle = '#1f1d6d';
            }
            ctx.stroke();
            ctx.fill();

            // Upper D
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(855, 150);
            ctx.lineTo(885, 150);
            ctx.lineTo(885, 450);
            ctx.lineTo(915, 450);
            ctx.lineTo(915, 750);
            ctx.lineTo(825, 750);
            ctx.lineTo(825, 450);
            ctx.lineTo(855, 450);
            ctx.moveTo(855, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'upperD') {
                ctx.fillStyle = '#a670b8';
            }
            ctx.stroke();
            ctx.fill();

            // Upper E
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(960, 150);
            ctx.lineTo(1005, 150);
            ctx.lineTo(1005, 750);
            ctx.lineTo(915, 750);
            ctx.lineTo(915, 450);
            ctx.lineTo(960, 450);
            ctx.lineTo(960, 150);
            ctx.closePath();
            if (currentNote && currentNote === 'upperE') {
                ctx.fillStyle = '#a650a0';
            }
            ctx.stroke();
            ctx.fill();

            // Upper F
            if (currentNote && currentNote === 'upperF') {
                ctx.fillStyle = '#a2395b';
            } else {
                ctx.fillStyle = 'white';
            }
            ctx.fillRect(1005, 150, 90, 600);
            ctx.strokeRect(1005, 150, 90, 600);

            // Lower C#/D flat
            if (currentNote && currentNote === 'dFlat') {
                ctx.fillStyle = '#c11c17';
            } else {
                ctx.fillStyle = 'black';
            }
            ctx.fillRect(150, 150, 75, 300);

            // Lower D#/E flat
            if (currentNote && currentNote === 'eFlat') {
                ctx.fillStyle = '#e27a1d';
            } else {
                ctx.fillStyle = 'black';
            }
            ctx.fillRect(255, 150, 75, 300);

            // F#/G flat
            if (currentNote && currentNote === 'gFlat') {
                ctx.fillStyle = '#4ca82b';
            } else {
                ctx.fillStyle = 'black';
            }
            ctx.fillRect(420, 150, 75, 300);

            // G#/A flat
            if (currentNote && currentNote === 'aFlat') {
                ctx.fillStyle = '#20b2aa';
            } else {
                ctx.fillStyle = 'black';
            };
            ctx.fillRect(525, 150, 60, 300);

            // A#/B Flat
            if (currentNote && currentNote === 'bFlat') {
                ctx.fillStyle = '#6f6da7';
            } else {
                ctx.fillStyle = 'black';
            }
            ctx.fillRect(615, 150, 75, 300);

            // Upper C#/D flat
            if (currentNote && currentNote === 'upperDflat') {
                ctx.fillStyle = '#502e72';
            } else {
                ctx.fillStyle = 'black';
            }
            ctx.fillRect(780, 150, 75, 300);

            // Upper D#/E flat
            if (currentNote && currentNote === 'upperEflat') {
                ctx.fillStyle = '#a63570';
            } else {
                ctx.fillStyle = 'black';
            }
            ctx.fillRect(885, 150, 75, 300);
        }

        // define the start screen
        startScreen = (function (input) {

            var greenVal = 0;
            var direction = 1;
            var transitioning = false;
            var wasButtonDown = false;


            function draw(canvas, ctx) {

                var y = ctx.canvas.height / 2;
                var color = 'rgb(0,' + greenVal + ',0)';

                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '224px Tangerine';
                centerText(ctx, title, y);

                ctx.strokeStyke = 'white';
                ctx.font = '60px Tangerine';
                centerText(ctx, 'A project made by Christine St. Jean, Corey Salmon, and Zach Guthrie', y + 150);

                ctx.fillStyle = color;
                ctx.font = '60px Tangerine';
                centerText(ctx, 'click to begin', y + 250);
            }

            function update() {

                greenVal += 1 * direction;
                if (greenVal > 225) direction = -1;
                if (greenVal < 20) direction = 1;

                var isButtonDown = input.isButtonDown();
                var mouseJustClicked = !isButtonDown && wasButtonDown;

                if (mouseJustClicked && !transitioning) {
                    transitioning = true;
                    startScreen = mainScreen;
                }

                wasButtonDown = isButtonDown;
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));
        
        infoScreen = (function (input) {
            var wasButtonDown = false;

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.font = '120px Tangerine';

                if (nextScreen) {
                    if (nextScreen === trainingScreen) {
                        centerText(ctx, 'Training Screen', 200);

                        ctx.font = '100px Tangerine';
                        centerText(ctx, 'click to begin', 725);

                        ctx.font = '76px Tangerine';
                        ctx.fillStyle = 'black';
                        centerText(ctx, 'Press the keys on your keyboard that correspond to', 350);
                        centerText(ctx, 'the letters on the piano. When you are finished,', 475);
                        centerText(ctx, 'press the button at the bottom to return to the main screen.', 600);
                    } else if (nextScreen === gameScreen) {
                        centerText(ctx, 'Game Screen Rules', 200);

                        ctx.font = '100px Tangerine';
                        centerText(ctx, 'click to begin', 725);

                        ctx.fillStyle = 'black';
                        ctx.font = '80px Tangerine';
                        centerText(ctx, 'When it is your team\'s turn, click on any of the', 350);
                        centerText(ctx, 'song tiles in order to try and guess the song!', 475);
                        centerText(ctx, 'More points are awarded for harder songs.', 600);
                    } else if (nextScreen === improvScreen) {
                        centerText(ctx, 'The Improv Game', 200);

                        ctx.font = '100px Tangerine';
                        centerText(ctx, 'click to begin', 770);

                        ctx.font = '68px Tangerine';
                        ctx.fillStyle = 'black';
                        centerText(ctx, 'Player 1, after clicking on this screen, you will have 10 seconds', 350);
                        centerText(ctx, 'to create your own improvisational song. After another countdown,', 450);
                        centerText(ctx, 'Player 2 will have 10 seconds to replicate Player 1\'s song.', 550);
                        centerText(ctx, 'Results will be shown immediately after player 2\'s attempt.', 650);
                    //} else if (nextScreen === creationScreen) {
                    //    centerText(ctx, 'WORK IN PROGRESS', 200);
                    } else if (nextScreen === countdownScreen) {
                        centerText(ctx, 'How to Play', 200);

                        ctx.font = '100px Tangerine';
                        centerText(ctx, 'click to begin', 760);

                        ctx.font = '76px Tangerine';
                        ctx.fillStyle = 'black';
                        if (improvRound === 1) {
                            ctx.font = '60px Tangerine';
                            centerText(ctx, 'Player 1, after clicking on this screen, you will have 10 seconds', 350);
                            centerText(ctx, 'to create your own improvisational song. After another countdown,', 450);
                            centerText(ctx, 'Player 2 will have 10 seconds to replicate Player 1\'s song.', 550);
                            centerText(ctx, 'Results will be shown immediately after player 2\'s attempt.', 650);
                        } else if (recordRound === 1) {
                            centerText(ctx, 'Player 1, you now have 10 seconds to replicate', 350);
                            centerText(ctx, 'the recording as best as you can. Every correct note will add', 475);
                            centerText(ctx, 'points, any wrong or extra notes will subtract points. Good luck!', 600);
                        } else if (recordRound === 2) {
                            centerText(ctx, 'Player 2, you now have 10 seconds to replicate', 350);
                            centerText(ctx, 'the next portion of the recording. The same', 450);
                            centerText(ctx, 'scoring rules apply here. This section may be identical', 550);
                            centerText(ctx, 'to the first section added by Player 1. Good luck!', 650);
                        } else if (recordRound === 3) {
                            centerText(ctx, 'Player 1, you now have 10 seconds to add one', 350);
                            centerText(ctx, 'more portion to the song. Note that it will', 450);
                            centerText(ctx, 'not be the same as the first or second parts. Sing the song', 550);
                            centerText(ctx, 'in your head until you get a third part, and go for broke!', 650);
                        }
                    } else if (nextScreen === guessScreen) {
                        centerText(ctx, 'Guess Screen', 200);

                        ctx.font = '100px Tangerine';
                        centerText(ctx, 'click to begin', 725);

                        ctx.font = '76px Tangerine';
                        ctx.fillStyle = 'black';
                        centerText(ctx, 'There will be 4 song titles on the next page.', 350);
                        centerText(ctx, 'Observer, you must now attempt to guess which song title', 475);
                        centerText(ctx, 'is the correct title. Correct guesses give 100 points!', 600);
                    }
                }
            }

            function update() {
                var isButtonDown = input.isButtonDown();
                var mouseJustClicked = !isButtonDown && wasButtonDown;

                if (mouseJustClicked) {
                    if (nextScreen) {
                        startScreen = nextScreen;
                    }
                }

                wasButtonDown = isButtonDown;
            }

            return {
                draw: draw,
                update: update
            }
        }(mouseClick));

        mainScreen = (function (input) {
            var buttons = [{x: 200, y: 550, w: 200, h: 150},
                {x: 500, y: 550, w: 200, h: 150},
                {x: 800, y: 550, w: 200, h: 150}];
                //{x: 200, y: 775, w: 800, h: 100}];

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.font = '224px Tangerine';
                centerText(ctx, 'Main Menu', 225);
                ctx.font = '124px Tangerine';
                centerText(ctx, 'Pick a game mode', 375);

                ctx.fillStyle = 'black';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                }

                ctx.strokeStyle = 'black';
                ctx.fillStyle = 'white';
                ctx.font = '60px Tangerine';

                measurement = ctx.measureText('Training');
                ctx.fillText('Training', 300 - measurement.width / 2, 625);
                ctx.strokeText('Training', 300 - measurement.width / 2, 625);

                ctx.font = '48px Tangerine';
                measurement = ctx.measureText('Main Game');
                ctx.fillText('Main Game', 600 - measurement.width / 2, 625);
                ctx.strokeText('Main Game', 600 - measurement.width / 2, 625);

                measurement = ctx.measureText('Improv Game');
                ctx.fillText('Improv Game', 900 - measurement.width / 2, 625);
                ctx.strokeText('Improv Game', 900 - measurement.width / 2, 625);

                //ctx.font = '96px Tangerine';
                //measurement = ctx.measureText('Create your own song');
                //centerText(ctx, 'Create your own song', 845);
            }

            function update() {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button == buttons[0]) {
                        canvas.removeEventListener('click', _func);
                        nextScreen = trainingScreen;
                        startScreen = infoScreen;
                    } else if (button == buttons[1]) {
                        canvas.removeEventListener('click', _func);
                        improvRound = 0;
                        //creationRound = 0;
                        startScreen = settingScreen;
                    } else if (button == buttons[2]) {
                        canvas.removeEventListener('click', _func);
                        improvRound = 1;
                        improvRecord = "";
                        nextScreen = countdownScreen;
                        startScreen = infoScreen;
                    //} else if (button == buttons[3]) {
                    //    canvas.removeEventListener('click', _func);
                    //    creationRound = 1;
                    //    creationRecord = "";
                    //    startScreen = countdownScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            }
        }(mouseClick));

        trainingScreen = (function (input) {
            var buttons = [{x: 900, y: 775, w: 150, h: 100}];
            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.strokeStyle = 'black';
                ctx.fillStyle = 'white';
                drawKeys(ctx);
                labelKeys(ctx);

                ctx.fillStyle = 'black';
                ctx.fillRect(buttons[0].x, buttons[0].y, buttons[0].w, buttons[0].h);

                ctx.fillStyle = 'white';
                ctx.font = '54px Tangerine';
                var measurement = ctx.measureText('Return');
                ctx.fillText('Return', 975 - measurement.width / 2, 840);
                ctx.strokeText('Return', 975 - measurement.width / 2, 840);
            }

            function update() {
                document.onkeydown = function (e) {
                    var soundId = sounds[e.keyCode];
                    if (soundId) {
                        var sound = new Audio("./soundEffects/" + sounds[e.keyCode] + ".mp3");
                        sound.play();
                        currentNote = sounds[e.keyCode];
                        drawKeys(ctx);
                    }
                }
                document.onkeyup = function (e) {
                    currentNote = null;
                }

                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button !== null) {
                        canvas.removeEventListener('click', _func);
                        document.onkeydown = null;
                        document.onkeyup = null;
                        startScreen = mainScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        // define the setting screen for the game
        settingScreen = (function (input) {
            var wasButtonDown = false;
            var transitioning = false;
            var buttons = [{x: 120, y: 500, w: 240, h: 200},
                            {x: 480, y: 500, w: 240, h: 200},
                            {x: 840, y: 500, w: 240, h: 200}];

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '172px Tangerine';
                centerText(ctx, 'Settings', 200);

                ctx.font = '86px Tangerine';
                centerText(ctx, 'Please choose the number of teams in this game below', 350);

                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillStyle = 'black';
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                    numberButton(ctx, i + 1, buttons[i]);                
                }
            }

            function numberButton(ctx, text, button) {
                ctx.font = '150px monospace';
                ctx.strokeStyle = 'black';
                ctx.fillStyle = '#ffffff';
                var measurement = ctx.measureText(text);
                var x = 80 + button.x;
                ctx.fillText(text, x, 650);
                ctx.strokeText(text, x, 650); 
            }

            function update(canvas, elapsed) {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button == buttons[0]) {
                        transitioning = true;
                        numPlayers = 1;
                        canvas.removeEventListener('click', _func);
                        nextScreen = gameScreen;
                        startScreen = infoScreen;
                    } else if (button == buttons[1]) {
                        transitioning = true;
                        players[1] = {idNum: 2, score: 0};
                        numPlayers = 2;
                        canvas.removeEventListener('click', _func);
                        nextScreen = gameScreen;
                        startScreen = infoScreen;
                    } else if (button == buttons[2]) {
                        transitioning = true;
                        players[1] = {idNum: 2, score: 0};
                        players[2] = {idNum: 3, score: 0};
                        numPlayers = 3;
                        canvas.removeEventListener('click', _func);
                        nextScreen = gameScreen;
                        startScreen = infoScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        gameScreen = (function (input) {
            var buttons = [];
            var firstTime = true;

            function draw(canvas, ctx) {
                var easyMeasure = ctx.measureText('Easy');
                var medMeasure = ctx.measureText('Medium');
                var hardMeasure = ctx.measureText('Hard');
                var x1, x2, x3;
                var y1, y2, y3;
                var teamOne, teamTwo, teamThree;

                if (firstTime) {
                    firstTime = false;
                    
                    if (currentSong === guess) {
                        players[currentPlayer - 1].score += 100;
                    }

                    if (numPlayers == 1) {
                        currentPlayer = 1;
                    } else if (numPlayers == 2 && currentPlayer == 2) {
                        currentPlayer = 1;
                    } else if (numPlayers == 3 && currentPlayer == 3) {
                        currentPlayer = 1;
                    } else {
                        currentPlayer++;
                    }
                }
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = '#000000';
                ctx.font = '120px Tangerine';
                centerText(ctx, title, 100);
                for (var i = 0; i < 4; i++) {
                    for (var j = 0; j < 6; j++) {
                        var num = (i * 6) + j;
                        buttons[num] = {x: 150 + (j * 150), y: 140 + (i * 150), w: 150, h: 150, chosen: false};
                        if (num - 6 >= 0) {
                            if (chosen[num - 6]) {
                                buttons[num].chosen = true;
                            }
                        }
                        songs[num] = {title: songTitles[num], x: 150 + (j * 150), y: 140 + (i * 150)};
                    }
                }

                for (var num = 0; num < 24; num++) {
                    if (buttons[num].chosen) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = '#78ff87';
                    }
                    ctx.fillRect(buttons[num].x, buttons[num].y, buttons[num].w, buttons[num].h);
                    ctx.strokeRect(buttons[num].x, buttons[num].y, buttons[num].w, buttons[num].h);
                }

                ctx.fillStyle = '#ffffff';
                labelGrid(ctx, 'Easy', 'Medium', 'Hard');

                ctx.font = '96px Tangerine';
                if (numPlayers == 1) {
                    ctx.fillStyle = 'red';
                    centerText(ctx, 'Team 1: ' + players[0].score, 825);
                } else if (numPlayers == 2) {
                    teamOne = ctx.measureText('Team 1: ' + players[0].score);
                    teamTwo = ctx.measureText('Team 2: ' + players[1].score);
                    x1 = (ctx.canvas.width - teamOne.width) / 4;
                    x2 = ctx.canvas.width / 2 + 300 - teamTwo.width / 2;

                    if (currentPlayer == 1) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 1: ' + players[0].score, x1, 825);
                    ctx.strokeText('Team 1: ' + players[0].score, x1, 825);
                    if (currentPlayer == 2) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 2: ' + players[1].score, x2, 825);
                    ctx.strokeText('Team 2: ' + players[1].score, x2, 825);
                } else {
                    teamOne = ctx.measureText('Team 1: ' + players[0].score);
                    teamThree = ctx.measureText('Team 3: ' + players[2].score);
                    x1 = 225 - (teamOne.width / 2);
                    if (currentPlayer == 2) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    centerText(ctx, 'Team 2: ' + players[1].score, 825);
                    x3 = 825;

                    if (currentPlayer == 1) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 1: ' + players[0].score, x1, 825);
                    ctx.strokeText('Team 1: ' + players[0].score, x1, 825);

                    if (currentPlayer == 3) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 3: ' + players[2].score, x3, 825);
                    ctx.strokeText('Team 3: ' + players[2].score, x3, 825);                    
                }
            }

            function labelGrid(ctx, topLabel, midLabel, botLabel) {
                ctx.font = '50px Tangerine';
                var topMeasure = ctx.measureText(topLabel);
                var midMeasure = ctx.measureText(midLabel);
                var botMeasure = ctx.measureText(botLabel);

                for (var i = 0; i < 6; i++) {
                    ctx.fillText(topLabel, 225 + (i * 150) - (topMeasure.width / 2), 365);
                    ctx.strokeText(topLabel, 225 + (i * 150) - (topMeasure.width / 2), 365);
                    
                    ctx.fillText(midLabel, 225 + (i * 150) - (midMeasure.width / 2), 515);
                    ctx.strokeText(midLabel, 225 + (i * 150) - (midMeasure.width / 2), 515);

                    ctx.fillText(botLabel, 225 + (i * 150) - (botMeasure.width / 2) - 5, 665);
                    ctx.strokeText(botLabel, 225 + (i * 150) - (botMeasure.width / 2) - 5, 665);                
                }

                var measure = ctx.measureText('Classical');
                ctx.fillText('Classical', 225 - (measure.width / 2) - 5, 225);
                ctx.strokeText('Classical', 225 - (measure.width / 2) - 5, 225);

                measure = ctx.measureText('Nursery');
                ctx.fillText('Nursery', 375 - (measure.width / 2), 195);
                ctx.strokeText('Nursery', 375 - (measure.width / 2), 195);

                measure = ctx.measureText('Rhymes');
                ctx.fillText('Rhymes', 375 - (measure.width / 2), 255);
                ctx.strokeText('Rhymes', 375 - (measure.width / 2), 255);

                measure = ctx.measureText('On the');
                ctx.fillText('On the', 525 - (measure.width / 2), 195);
                ctx.strokeText('On the', 525 - (measure.width / 2), 195);

                measure = ctx.measureText('Radio');
                ctx.fillText('Radio', 525 - (measure.width / 2), 255);
                ctx.strokeText('Radio', 525 - (measure.width / 2), 255);

                measure = ctx.measureText('One Hit');
                ctx.fillText('One Hit', 675 - (measure.width / 2), 195);
                ctx.strokeText('One Hit', 675 - (measure.width / 2), 195);

                measure = ctx.measureText('Wonders');
                ctx.fillText('Wonders', 675 - (measure.width / 2), 255);
                ctx.strokeText('Wonders', 675 - (measure.width / 2), 255);

                measure = ctx.measureText('Classic');
                ctx.fillText('Classic', 825 - (measure.width / 2), 195);
                ctx.strokeText('Classic', 825 - (measure.width / 2), 195);

                measure = ctx.measureText('Rock');
                ctx.fillText('Rock', 825 - (measure.width / 2), 255);
                ctx.strokeText('Rock', 825 - (measure.width / 2), 255);

                measure = ctx.measureText('Game');
                ctx.fillText('Game', 975 - (measure.width / 2), 195);
                ctx.strokeText('Game', 975 - (measure.width / 2), 195);

                measure = ctx.measureText('Music');
                ctx.fillText('Music', 975 - (measure.width / 2), 255);
                ctx.strokeText('Music', 975 - (measure.width / 2), 255);
            }

            function getSong(button) {
                var song = null;

                if (button.x === 150) {
                    if (button.y === 290) {
                        song = songs[0].title;
                        chosen[0] = true;
                    } else if (button.y === 440) {
                        song = songs[6].title;
                        chosen[6] = true;
                    } else if (button.y === 590) {
                        song = songs[12].title;
                        chosen[12] = true;
                    }
                }

                if (button.x === 300) {
                    if (button.y === 290) {
                        song = songs[1].title;
                        chosen[1] = true;
                    } else if (button.y === 440) {
                        song = songs[7].title;
                        chosen[7] = true;
                    } else if (button.y === 590) {
                        song = songs[13].title;
                        chosen[13] = true;
                    }
                }

                if (button.x === 450) {
                    if (button.y === 290) {
                        song = songs[2].title;
                        chosen[2] = true;
                    } else if (button.y === 440) {
                        chosen[8] = true;
                        song = songs[8].title;
                    } else if (button.y === 590) {
                        chosen[14] = true;
                        song = songs[14].title;
                    }
                }

                if (button.x === 600) {
                    if (button.y === 290) {
                        song = songs[3].title;
                        chosen[3] = true;
                    } else if (button.y === 440) {
                        song = songs[9].title;
                        chosen[9] = true;
                    } else if (button.y === 590) {
                        song = songs[15].title;
                        chosen[15] = true;
                    }
                }

                if (button.x === 750) {
                    if (button.y === 290) {
                        song = songs[4].title;
                        chosen[4] = true;
                    } else if (button.y === 440) {
                        song = songs[10].title;
                        chosen[10] = true;
                    } else if (button.y === 590) {
                        song = songs[16].title;
                        chosen[16] = true;
                    }
                }

                if (button.x === 900) {
                    if (button.y === 290) {
                        song = songs[5].title;
                        chosen[5] = true;
                    } else if (button.y === 440) {
                        song = songs[11].title;
                        chosen[11] = true;
                    } else if (button.y === 590) {
                        song = songs[17].title;
                        chosen[17] = true;
                    }
                }
                return song;
            }

            function update() {
                var i = 0;
                var endCheck = true;
                while (i < 18) {
                    if (chosen[i] === false) {
                        endCheck = false;
                    }
                    i++;
                }

                if (endCheck) {
                    startScreen = winnerScreen;
                }

                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button !== null && button.y > 150 && !button.chosen) {
                        transitioning = true;
                        currentTile = button;
                        currentSong = getSong(button);
                        canvas.removeEventListener('click', _func);
                        firstTime = true;
                        startScreen = countdownScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        countdownScreen = (function (input) {
            var sec = 3;
            var next = false;
            var wasButtonDown = false;
            var transitioning = false;
            var count = 0;

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '172px Tangerine';
                if (count < 50) {
                    centerText(ctx, '3', 150);
                } else if (count < 100) {
                    centerText(ctx, '2', 300);
                } else if (count < 150) {
                    centerText(ctx, '1', 450);
                } else if (count < 200) {
                    if (improvRound === 1) {
                        centerText(ctx, 'Improv!', 600);
                    } else if (improvRound === 2) {
                        centerText(ctx, 'Replicate!', 600);
                    //} else if (creationRound === 1 || 2) {
                    //    centerText(ctx, 'Create!', 600);
                    } else if (recordRound === 0) {
                        centerText(ctx, 'Listen!', 600);
                    } else {
                        centerText(ctx, 'Record!', 600);
                    }
                } else {
                    next = true;
                }
            }

            function update(canvas, elapsed) {
                count++;
                if (next) {
                    transitioning = true;
                    count = 0;
                    next = false;
                    if (improvRound === 1 || improvRound === 2) {
                        startScreen = improvScreen;
                    // } else if (creationRound !== 0) {
                    //     startScreen = creationScreen;
                    } else if (recordRound === 0) {
                        startScreen = listenScreen;
                    } else {
                        startScreen = pianoScreen;
                    }
                }
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        listenScreen = (function (input) {
            var transitioning = false;
            var buttons = [{x: 425, y: 500, w: 150, h: 50}, {x: 625, y: 500, w: 150, h: 50}];
            var filePath;
            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                filePath = './songs/' + currentSong + ".mp3";
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '172px Tangerine';
                centerText(ctx, 'Click to Listen to Song', 200);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '100px Tangerine';
                centerText(ctx, 'Player 1 put headphones on before listening', 400);
                ctx.fillStyle = '#000000';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                }
                ctx.font = '50px Tangerine';
                ctx.fillStyle = 'white';
                ctx.fillText('Listen', buttons[0].x + 28, buttons[0].y + 40);
                ctx.fillText('Continue', buttons[1].x + 15, buttons[1].y + 40);
            }
            function update(canvas, elapsed) {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button == buttons[0]) {                      
                        var sound = new Audio(filePath);
                        sound.volume = 0.2;
                        sound.play();
                    } else if (button == buttons[1]) {
                        recordRound = 1;
                        canvas.removeEventListener('click', _func);
                        nextScreen = countdownScreen;
                        startScreen = infoScreen;
                    }
                }, false);
            }
            return {
                draw: draw,
                update: update
            }
        }(mouseClick));

        guessScreen = (function (input) {
            var wasButtonDown = false;
            var transitioning = false;
            var choice1, choice2, choice3, choice4;
            var firstTime = true;
            var correct = Math.floor(Math.random() * 4);
            var buttons = [{x: 120, y: 300, w: 800, h: 50},
                            {x: 120, y: 400, w: 800, h: 50},
                            {x: 120, y: 500, w: 800, h: 50},
                            {x: 120, y: 600, w: 800, h: 50}];
            var bs = [{x: 60, y: 300, w: 50, h: 50},
                            {x: 60, y: 400, w: 50, h: 50},
                            {x: 60, y: 500, w: 50, h: 50},
                            {x: 60, y: 600, w: 50, h: 50}];

            function pullTitles() {
                var choice;
                for (var i = 0; i < 4; i++) {
                    choice = Math.floor(Math.random() * 18);
                    if (correct === i) {
                        if (i === 0) {
                            choice1 = currentSong;
                        } else if (i === 1) {
                            choice2 = currentSong;
                        } else if (i === 2) {
                            choice3 = currentSong;
                        } else {
                            choice4 = currentSong;
                        }
                    } else {
                        if (i === 0) {
                            choice1 = songs[choice].title;
                        } else if (i === 1) {
                            if (choice1 !== songs[choice].title) {
                                choice2 = songs[choice].title;
                            } else {
                                i--;
                            }
                        } else if (i === 2) {
                            if ((choice1 || choice2) !== songs[choice].title) {
                                choice3 = songs[choice].title;
                            } else {
                                i--;
                            }
                        } else {
                            if ((choice1 || choice2 || choice3) !== songs[choice].title) {
                                choice4 = songs[choice].title;
                            } else {
                                i--;
                            }
                        } 
                    }
                }
            }

            function draw(canvas, ctx) {
                if (firstTime) {
                    firstTime = false;
                    pullTitles();
                }
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '172px Tangerine';
                centerText(ctx, 'Guess the Song', 200);

                ctx.fillStyle = '#000000';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                    ctx.fillRect(bs[i].x, bs[i].y, bs[i].w, bs[i].h)
                }
                ctx.font = '50px Tangerine';
                ctx.fillStyle = 'white';
                ctx.fillText(choice1, bs[0].x + 80, bs[0].y + 37);
                ctx.font = '50px Tangerine';
                ctx.fillStyle = 'white';
                ctx.fillText(choice2, bs[1].x + 80, bs[1].y + 37);
                ctx.font = '50px Tangerine';
                ctx.fillStyle = 'white';
                ctx.fillText(choice3, bs[2].x + 80, bs[2].y + 37);
                ctx.font = '50px Tangerine';
                ctx.fillStyle = 'white';
                ctx.fillText(choice4, bs[3].x + 80, bs[3].y + 37);
                
            }
            
           
            function update() {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(bs, e.offsetX, e.offsetY);
                    if (button == bs[0]) {
                        canvas.removeEventListener('click', _func);
                        guess = choice1;
                        endRound();
                    } else if (button == bs[1]) {
                        guess = choice2;
                        canvas.removeEventListener('click', _func);
                        endRound();
                    } else if (button == bs[2]) {
                        canvas.removeEventListener('click', _func);
                        guess = choice3;
                        endRound();
                    } else if (button == bs[3]) {
                        canvas.removeEventListener('click', _func);
                        guess = choice4;
                        endRound();
                    }
                }, false);
            }
            
            function endRound() {
                recordRound = 0;
                firstTime = true;
                startScreen = gameScreen;
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        pianoScreen = (function (input) {
            var wasButtonDown = false;
            var noteIterator = 0;
            var noteString = '';
            var noteCount = 0;
            var transcription;
            var recordLength = 0;
            var topCount = 0;

            function getTranscript(song) {
                var transcript = null;
                if (transcripts[song] !== null) {
                    if (recordRound == 1) {
                        transcript = transcripts[song][0];
                    } else if (recordRound == 2) {
                        transcript = transcripts[song][1];
                    } else if (recordRound == 3) {
                        transcript = transcripts[song][2];
                    }
                }
                return transcript;
            }
            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.strokeStyle = 'black';
                drawKeys(ctx);
                labelKeys(ctx);
                recordLength++;
            }

            function update() {
                document.onkeydown = function (e) {
                    var soundId = sounds[e.keyCode];
                    if (soundId) {
                        var sound = new Audio("./soundEffects/" + sounds[e.keyCode] + ".mp3");
                        sound.play();
                        currentNote = sounds[e.keyCode];
                        noteString = noteString.concat(e.keyCode);
                        noteCount++;
                        if (e.keyCode === '186' || e.keyCode === '222') {
                            topCount++;
                        }
                        if (topCount === 2) {
                            topCount = 0;
                            noteCount++;
                        }

                        drawKeys(ctx);
                    }
                }
                document.onkeyup = function (e) {
                    currentNote = null;
                }
                if (recordLength === (500 || 1000 || 1500)) {
                    transcription = getTranscript(currentSong);
                    endRecording();
                }
            }

            function endRecording() {
                var scriptSeg;
                var recordSeg;
                var scriptJump = false;
                var recordJump = false;
                var scriptShift = false;
                var recordShift = false;
                var j = 0;

                for (var i = 0; i < noteCount; i++) {
                    if (transcription) {
                        if (2 * i + 1 < transcription.length) {
                            if (recordJump) {
                                recordJump = false;
                                recordShift = false;
                                j++;
                            }
                            if (scriptJump) {
                                scriptSeg = transcription.substring(2 * i + 2, 2 * i + 4);
                            } else if (scriptShift) {
                                scriptSeg = transcription.substring(2 * i + 1, 2 * i + 3);
                            } else {
                                scriptSeg = transcription.substring(2 * i, 2 * i + 2);
                            }

                            if (recordShift) {
                                recordSeg = noteString.substring(2 * j + 1, 2 * j + 3);
                            } else {
                                recordSeg = noteString.substring(2 * j, 2 * j + 2);
                            }

                            if (scriptSeg === recordSeg) {
                                players[currentPlayer - 1].score += 50;
                                correctNotes++;
                            } else {
                                players[currentPlayer - 1].score -= 50;
                                incorrectNotes++;
                            }

                            if (scriptJump) {
                                scriptJump = false;
                                scriptShift = false;
                                continue;
                            }

                            if (scriptSeg === '18' || scriptSeg === '22') {
                                if (scriptShift) {
                                    scriptJump = true;
                                } else {
                                    scriptShift = true;
                                }
                            }

                            if (recordSeg === '18' || recordSeg === '22') {
                                if (recordShift) {
                                    
                                    recordJump = true;
                                } else {
                                    recordShift = true;
                                }
                            }
                        } else {
                            players[currentPlayer - 1].score -= 10;
                            extraNotes++;
                        }
                        j++;
                    }
                }
                if (recordRound === 3) {
                    recordLength = 0;
                    recordCount = 0;
                    noteString = '';
                    noteCount = 0;
                    j = 0;
                    document.onkeydown = null;
                    document.onkeyup = null;
                    startScreen = recordResultsScreen; 
                } else {
                    recordLength = 0;
                    recordCount = 0;
                    noteString = '';
                    noteCount = 0;
                    j = 0;
                    recordRound++;
                    document.onkeydown = null;
                    document.onkeyup = null;
                    nextScreen = countdownScreen;
                    startScreen = infoScreen;
                }
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        recordResultsScreen = (function (input) {
            var firstTime = true;
            var buttons = [{x: 850, y: 725, w: 250, h: 100}];
            var measure;

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                if (firstTime) {
                    firstTime = false;
                    ctx.globalAlpha = 0;
                } else {
                    ctx.globalAlpha += 0.05;
                }
                ctx.font = '144px Tangerine'
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                centerText(ctx, 'Results', 150);

                ctx.font = "72px Tangerine";
                ctx.fillText('Correct Notes: ' + correctNotes, ctx.canvas.width / 2 - 425, 300);
                ctx.strokeText('Correct Notes: ' + correctNotes, ctx.canvas.width / 2 - 425, 300);

                ctx.fillText('x 50 = ' + correctNotes * 50, ctx.canvas.width / 2 + 100, 300);
                ctx.strokeText('x 50 = ' + correctNotes * 50, ctx.canvas.width / 2 + 100, 300);

                ctx.fillText('Incorrect Notes: ' + incorrectNotes, ctx.canvas.width / 2 - 425, 400);
                ctx.strokeText('Incorrect Notes: ' + incorrectNotes, ctx.canvas.width / 2 - 425, 400);

                ctx.fillText('x -50 = -' + incorrectNotes * 50, ctx.canvas.width / 2 + 100, 400);
                ctx.strokeText('x -50 = -' + incorrectNotes * 50, ctx.canvas.width / 2 + 100, 400);

                ctx.fillText('Extra Notes: ' + extraNotes, ctx.canvas.width / 2 - 425, 500);
                ctx.strokeText('Extra Notes: ' + extraNotes, ctx.canvas.width / 2 - 425, 500);

                ctx.fillText('x -10 = -' + extraNotes * 10, ctx.canvas.width / 2 + 100, 500);
                ctx.strokeText('x -10 = -' + extraNotes * 10, ctx.canvas.width / 2 + 100, 500);

                ctx.fillText('' + correctNotes * 50 + ' - ' + incorrectNotes * 50 + ' - ' + extraNotes * 10 + ' = ' + (correctNotes * 50 - incorrectNotes * 50 - extraNotes * 10), ctx.canvas.width / 2 + 100, 625);
                ctx.strokeText('' + correctNotes * 50 + ' - ' + incorrectNotes * 50 + ' - ' + extraNotes * 10 + ' = ' + (correctNotes * 50 - incorrectNotes * 50 - extraNotes * 10), ctx.canvas.width / 2 + 100, 625);

                ctx.font = '84px Tangerine';

                ctx.fillText('Total Score: ' + players[0].score, ctx.canvas.width / 2 - 425, 625);
                ctx.strokeText('Total Score: ' + players[0].score, ctx.canvas.width / 2 - 425, 625);

                ctx.fillStyle = 'black';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                }

                ctx.fillStyle = 'white';
                ctx.strokeStyle = 'black';
                ctx.font = '52px Tangerine';
                measure = ctx.measureText('Guess the song!');
                ctx.fillText('Guess the song!', 975 - measure.width / 2, 780);
                ctx.strokeText('Guess the song!', 975 - measure.width / 2, 780);
            }

            function update() {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button !== null) {
                        canvas.removeEventListener('click', _func);
                        correctNotes = 0;
                        incorrectNotes = 0;
                        extraNotes = 0;
                        nextScreen = guessScreen;
                        startScreen = infoScreen;
                    }
                }, false);
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        improvScreen = (function (input) {
            var noteString = '';
            var noteCount = 0;
            var topCount = 0;
            var recordLength = 0;
            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.strokeStyle = 'black';
                ctx.fillStyle = 'white';
                drawKeys(ctx);
                labelKeys(ctx);
                recordLength++;
            }

            function update() {
                document.onkeydown = function (e) {
                    var soundId = sounds[e.keyCode];
                    if (soundId) {
                        var sound = new Audio("./soundEffects/" + sounds[e.keyCode] + ".mp3");
                        sound.play();
                        currentNote = sounds[e.keyCode];
                        noteString = noteString.concat(e.keyCode);
                        noteCount++;
                        if (e.keyCode === '186' || e.keyCode === '222') {
                            topCount++;
                        }
                        if (topCount === 2) {
                            topCount = 0;
                            noteCount++;
                        }
                        drawKeys(ctx);
                    }
                }
                document.onkeyup = function (e) {
                    currentNote = null;
                }
                if (recordLength === (500 || 1000)) {
                    endRecording();
                }
            }

            function endRecording() {
                var improvSeg;
                var recordSeg;
                var improvJump = false;
                var recordJump = false;
                var improvShift = false;
                var recordShift = false;
                if (improvRound === 1) {
                    recordLength = 0;
                    noteCount = 0;
                    improvRecord = noteString;
                    noteString = '';
                    improvRound++;
                    document.onkeydown = null;
                    document.onkeyup = null;
                    startScreen = countdownScreen;
                } else {
                    recordLength = 0;
                    var j = 0;
                    for (var i = 0; i < noteCount; i++) {
                        if (2 * i + 1 < improvRecord.length) {
                            if (recordJump) {
                                recordJump = false;
                                recordShift = false;
                                j++;
                            }

                            if (improvJump) {
                                improvSeg = improvRecord.substring(2 * i + 2, 2 * i + 4);
                            } else if (improvShift) {
                                improvSeg = improvRecord.substring(2 * i + 1, 2 * i + 3);
                            } else {
                                improvSeg = improvRecord.substring(2 * i, 2 * i + 2);
                            }

                            if (recordShift) {
                                recordSeg = noteString.substring(2 * j + 1, 2 * j + 3);
                            } else {
                                recordSeg = noteString.substring(2 * j, 2 * j + 2);
                            }

                            if (improvSeg === recordSeg) {
                                players[0].score += 50;
                                correctNotes++;
                            } else {
                                players[0].score -= 50;
                                incorrectNotes++;
                            }

                            if (improvJump) {
                                improvJump = false;
                                improvShift = false;
                                continue;
                            }

                            if (improvSeg === '18' || improvSeg === '22') {
                                if (improvShift) {
                                    improvJump = true;
                                } else {;
                                    improvShift = true;
                                }
                            }

                            if (recordSeg === '18' || recordSeg === '22') {
                                if (recordShift) {
                                    recordJump = true;
                                } else {
                                    recordShift = true;
                                }
                            }
                        } else {
                            players[0].score -= 10;
                            extraNotes++;
                        }
                        j++;
                    }
                    document.onkeydown = null;
                    document.onkeyup = null;
                    improvRecord = null;
                    noteString = '';
                    noteCount = 0;
                    j = 0;
                    startScreen = improvResultsScreen;
                }
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        improvResultsScreen = (function (input) {
            var firstTime = true;
            var buttons = [{x: 850, y: 725, w: 250, h: 100}];
            var measure;

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                if (firstTime) {
                    firstTime = false;
                    ctx.globalAlpha = 0;
                } else {
                    ctx.globalAlpha += 0.05;
                }
                ctx.font = '144px Tangerine'
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                centerText(ctx, 'Results', 150);

                ctx.font = "72px Tangerine";
                ctx.fillText('Correct Notes: ' + correctNotes, ctx.canvas.width / 2 - 425, 300);
                ctx.strokeText('Correct Notes: ' + correctNotes, ctx.canvas.width / 2 - 425, 300);

                ctx.fillText('x 50 = ' + correctNotes * 50, ctx.canvas.width / 2 + 100, 300);
                ctx.strokeText('x 50 = ' + correctNotes * 50, ctx.canvas.width / 2 + 100, 300);

                ctx.fillText('Incorrect Notes: ' + incorrectNotes, ctx.canvas.width / 2 - 425, 400);
                ctx.strokeText('Incorrect Notes: ' + incorrectNotes, ctx.canvas.width / 2 - 425, 400);

                ctx.fillText('x -50 = -' + incorrectNotes * 50, ctx.canvas.width / 2 + 100, 400);
                ctx.strokeText('x -50 = -' + incorrectNotes * 50, ctx.canvas.width / 2 + 100, 400);

                ctx.fillText('Extra Notes: ' + extraNotes, ctx.canvas.width / 2 - 425, 500);
                ctx.strokeText('Extra Notes: ' + extraNotes, ctx.canvas.width / 2 - 425, 500);

                ctx.fillText('x -10 = -' + extraNotes * 10, ctx.canvas.width / 2 + 100, 500);
                ctx.strokeText('x -10 = -' + extraNotes * 10, ctx.canvas.width / 2 + 100, 500);

                ctx.fillText('' + correctNotes * 50 + ' - ' + incorrectNotes * 50 + ' - ' + extraNotes * 10 + ' = ' + players[0].score, ctx.canvas.width / 2 + 100, 625);
                ctx.strokeText('' + correctNotes * 50 + ' - ' + incorrectNotes * 50 + ' - ' + extraNotes * 10 + ' = ' + players[0].score, ctx.canvas.width / 2 + 100, 625);

                ctx.font = '84px Tangerine';

                ctx.fillText('Total Score: ' + players[0].score, ctx.canvas.width / 2 - 425, 625);
                ctx.strokeText('Total Score: ' + players[0].score, ctx.canvas.width / 2 - 425, 625);

                ctx.fillStyle = 'black';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                }

                ctx.fillStyle = 'white';
                ctx.strokeStyle = 'black';
                ctx.font = '52px Tangerine';
                measure = ctx.measureText('Return to menu');
                ctx.fillText('Return to menu', 975 - measure.width / 2, 780);
                ctx.strokeText('Return to menu', 975 - measure.width / 2, 780);
            }

            function update() {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button !== null) {
                        canvas.removeEventListener('click', _func);
                        players[0].score = 0;
                        correctNotes = 0;
                        incorrectNotes = 0;
                        extraNotes = 0;
                        startScreen = mainScreen;
                    }
                }, false);
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        /*creationScreen = (function (input) {
            var recordLength = 0;
            var noteString = '';
            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.strokeStyle = 'black';
                ctx.fillStyle = 'white';
                drawKeys(ctx);
                labelKeys(ctx);
                recordLength++;
            }

            function update() {
                document.onkeydown = function (e) {
                    var soundId = sounds[e.keyCode];
                    if (soundId) {
                        var sound = new Audio("./soundEffects/" + sounds[e.keyCode] + ".mp3");
                        sound.play();
                        noteString = noteString.concat(e.keyCode);
                        noteString = noteString.concat(recordLength);
                        noteString = noteString.concat('_');
                        currentNote = sounds[e.keyCode];
                        drawKeys(ctx);
                        
                    }
                }
                document.onkeyup = function (e) {
                    currentNote = null;
                }
                if (recordLength === (500 || 1000)) {
                    endRecording();
                }
            }

            function endRecording() {
                if (creationRound === 1) {
                    creationRound++;
                    recordLength = 0;
                    firstRecording = noteString;
                    noteString = '';
                    document.onkeydown = null;
                    document.onkeyup = null;
                    startScreen = countdownScreen;
                } else {
                    creationRound = 0;
                    recordLength = 0;
                    secondRecording = noteString;
                    noteString = '';
                    document.onkeydown = null;
                    document.onkeyup = null;
                    startScreen = playbackScreen;
                }
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));


        playbackScreen = (function (input) {
            var buttons = [{x: 450, y: 500, w: 300, h: 150}, {x: 850, y: 725, w: 250, h: 100}];
            var keyCode;
            var timeOnPage = 0;

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = 'black';
                ctx.strokeStyle = 'black';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                }

                ctx.fillStyle = '#78ff87';
                ctx.font = '164px Tangerine';
                centerText(ctx, 'Listen to your recording!', 150);

                ctx.font = '86px Tangerine';
                centerText(ctx, 'Press the button below to listen', 300);

                ctx.fillStyle = 'white';
                var measure = ctx.measureText('PLAY');
                ctx.fillText('PLAY', 600 - measure.width / 2 - 10, 595);
                ctx.strokeText('PLAY', 600 - measure.width / 2 - 10, 595);

                ctx.font = '52px Tangerine';
                measure = ctx.measureText('Return to menu');
                ctx.fillText('Return to menu', 975 - measure.width / 2, 780);
                ctx.strokeText('Return to menu', 975 - measure.width / 2, 780);

                timeOnPage++;
            }

            function update() {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button == buttons[0]) {
                        parseRecordings();
                        playLoop();
                    } else if (button == buttons[1]) {
                        firstRecording = '';
                        secondRecording = '';
                        notes = [];
                        timeFrames = [];
                        canvas.removeEventListener('click', _func);
                        startScreen = mainScreen;
                    }
                }, false);
            }

            function parseRecordings() {
                var i = 0;
                var j = 0;
                var k = 0;
                while (i < firstRecording.length) {
                    notes[k] = firstRecording.substring(i, i + 2);
                    j = 2 * i + 2;
                    while (j < firstRecording.length) {
                        if (firstRecording.charAt(j) == '_') {
                            break;
                        }
                        j++;
                    }
                    if (notes[k] === '18' || notes[k] === '22') {
                        timeFrames[k] = firstRecording.substring(i + 3, j);
                    } else {
                        timeFrames[k] = firstRecording.substring(i + 2, j);
                    }
                    i = j + 1;
                    k++;
                }

                i = 0;
                j = 0;

                while (i < secondRecording.length) {
                    notes[k] = secondRecording.substring(i, i + 2);
                    notes[k] = notes[k];
                    j = 2 * i + 2;
                    while (j < secondRecording.length) {
                        if (secondRecording.charAt(j) == '_') {
                            break;
                        }
                        j++;
                    }
                    if (notes[k] === '18' || notes[k] === '22') {
                        timeFrames[k] = Number(secondRecording.substring(i + 3, j)) * 10;
                    } else {
                        timeFrames[k] = Number(secondRecording.substring(i + 2, j)) * 10;
                    }
                    i = j + 1;
                    k++;
                }
            }

            function playLoop() {
                var i = 0;
                var k = 0;
                setTimeout(function() {
                    if (k < timeFrames.length) { 
                        if (timeFrames[k] == i) {
                            var sound = new Audio("./soundEffects/" + sounds[notes[k]] + ".mp3");
                            sound.play();
                            k++;
                        }
                    }
                    i += 10;
                    if (i < 10000) {
                        playLoop();
                    }
                }, 10)
            }

            return {
                draw: draw,
                update: update
            }
        }(mouseClick));
        */
        winnerScreen = (function (input) {
            var first, second, third;
            var init = true;
            var firstTie = false;
            var secondTie = false;
            var threeWayTie = false;
            var buttons = [{x: 300, y: 725, w: 600, h: 150}];

            function sortWinner() {
                if (numPlayers == 2) {
                    if (players[0].score > players[1].score) {
                        first = players[0];
                        second = players[1];
                    } else if (players[0].score < players[1].score) {
                        first = players[1];
                        second = players[2];
                    } else {
                        first = players[0];
                        second = players[1];
                        firstTie = true; 
                    }
                }
                if (numPlayers == 3) {
                    if (players[0].score > players[1].score) {
                        if (players[0].score > players[2].score) {
                            first = players[0];
                            if (players[1].score > players[2].score) {
                                second = players[1];
                                third = players[2];
                            } else if (players[1].score < players[2].score) {
                                second = players[2];
                                third = players[1];
                            } else {
                                second = players[1];
                                third = players[2];
                                secondTie = true; 
                            }
                        } else if (players[0].score < players[2].score) {
                            first = players[2];
                            second = players[0];
                            third = players[1];
                        } else {
                            first = players[0];
                            second = players[2];
                            third = players[1];
                            firstTie = true;
                        }
                    } else if (players[0].score < players[1].score) {
                        if (players[1].score > players[2].score) {
                            first = players[1];
                            if (players[0].score > players[2].score) {
                                second = players[0];
                                third = players[2];
                            } else if (players[0].score < players[2].score) {
                                second = players[2];
                                third = players[0];
                            } else {
                                second = players[0];
                                third = players[2];
                                secondTie = true;
                            }
                        } else if (players[1].score < players[2].score) {
                            first = players[2].score;
                            second = players[1].score;
                            third = players[0].score;
                        } else {
                            first = players[1];
                            second = players[2];
                            third = players[0];
                            firstTie = true;
                        }
                    } else {
                        if (players[1].score > players[2].score) {
                            first = players[0];
                            second = players[1];
                            third = players[2];
                            firstTie = true;
                        } else if (players[1].score < players[2].score) {
                            first = players[2];
                            second = players[0];
                            third = players[1];
                            secondTie = true;
                        } else {
                            first = players[0];
                            second = players[1];
                            third = players[2];
                            threeWayTie = true;
                        }
                    }
                }
            }

            function draw(canvas, ctx) {
                if (init) {
                    init = false;
                    sortWinner();
                }
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '164px Tangerine';
                centerText(ctx, 'Final Results', 150);
                
                ctx.fillStyle = 'black';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                }


                ctx.font = '68px Tangerine';
                ctx.fillStyle = 'white';
                centerText(ctx, 'Return to the Main Menu', 800);
               
                ctx.font = '86px Tangerine';
                ctx.fillStyle = '#ffd700';
                centerText(ctx, '1st Place: Team ' + first.idNum + '\t\t\t\t\t\t\t  Score: ' + first.score, 300);
                if (numPlayers = 2) {
                    if (firstTie) {
                        centerText(ctx, '1st Place: Team ' + second.idNum + '\t\t\t\t\t\t\t  Score: ' + second.score, 450);
                    } else {
                        ctx.fillStyle = '#c0c0c0';
                        centerText(ctx, '2nd Place: Team ' + second.idNum + '\t\t\t\t\t\t\t  Score: ' + second.score, 450);
                    }
                }

                if (numPlayers = 3) {
                    if (firstTie) {
                        centerText(ctx, '1st Place: Team ' + second.idNum + '\t\t\t\t\t\t\t  Score: ' + second.score, 450);
                        ctx.fillStyle = '#cd7f32';
                        centerText(ctx, '3rd Place: Team ' + third.idNum + '\t\t\t\t\t\t\t  Score: ' + third.score, 600);
                    } else if (secondTie) {
                        ctx.fillStyle = '#c0c0c0';
                        centerText(ctx, '2nd Place: Team ' + second.idNum + '\t\t\t\t\t\t\t  Score: ' + second.score, 450);
                        centerText(ctx, '2nd Place: Team ' + third.idNum + '\t\t\t\t\t\t\t  Score: ' + third.score, 600);
                    } else if (threeWayTie) {
                        centerText(ctx, '1st Place: Team ' + second.idNum + '\t\t\t\t\t\t\t  Score: ' + second.score, 450);
                        centerText(ctx, '1st Place: Team ' + third.idNum + '\t\t\t\t\t\t\t  Score: ' + third.score, 600);
                    } else {
                        ctx.fillStyle = '#c0c0c0';
                        centerText(ctx, '2nd Place: Team ' + second.idNum + '\t\t\t\t\t\t\t  Score: ' + second.score, 450);
                        ctx.fillStyle = '#cd7f32';
                        centerText(ctx, '3rd Place: Team ' + third.idNum + '\t\t\t\t\t\t\t  Score: ' + third.score, 600);
                    }
                }

            }

            function update() {
                canvas.addEventListener('click', function _func(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button !== null) {
                        canvas.removeEventListener('click', _func);
                        players = [];
                        players[0] = {idNum: 1, score: 0};
                        for (i = 0; i < chosen.length; i++) {
                            chosen[i] = false;
                        }
                        init = true;
                        startScreen = mainScreen;
                    }
                }, false);
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));
        
        beginLoop();

    </script>
</body>
</html>