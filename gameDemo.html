<html>
<head>
    <meta charset="utf-8">
    <link href='https://fonts.googleapis.com/css?family=Tangerine:700' rel='stylesheet' type='text/css'>
    <title>What's That Song? An interactive guessing game made for Professor Loukissas's LMC 2700 Class</title>
    <style>
        * { 
            padding: 0;
            margin: 0;
        }
        canvas {
            background-image: url('https://hdwallpapers.cat/wallpaper_1600x900/vintage_music_paper_firefox_persona_score_1600x900_hd-wallpaper-630445.jpg');
            display: block;
            margin: 0;
            auto;
        }
    </style>
</head>
<body>
    <canvas id="board"></canvas>
    <script>
        var canvas;
        var surface
        var startScreen;
        var settingScreen;
        var gameScreen;
        var simpleClickSwitch;
        var numPlayers;

        function beginLoop() {
            var frameId = 0;
            var lastFrame = Date.now();

            function loop() {
                var thisFrame = Date.now();

                var elapsed = thisFrame - lastFrame;

                frameId = window.requestAnimationFrame(loop);

                startScreen.update(canvas, elapsed);
                startScreen.draw(canvas, surface);

                lastFrame = thisFrame;
            }

            loop();
        }

        canvas = document.querySelector('canvas#board');
        canvas.setAttribute('width', 1200);
        canvas.setAttribute('height', 900);

        surface = canvas.getContext('2d');

        mouseClick = (function (target) {
            var isButtonDown = false;

            target.addEventListener('mousedown', function () {
                isButtonDown = true;
            });
            target.addEventListener('mouseup', function () {
                isButtonDown = false;
            });

            return {
                isButtonDown: function () {
                    return isButtonDown;
                }
            };
        }(document));

        function centerText(ctx, text, y) {
            var measurement = ctx.measureText(text);
            var x = (ctx.canvas.width - measurement.width) / 2;
            ctx.fillText(text, x, y);
            ctx.strokeText(text, x, y);
        }

        function buttonCollision(buttons, x, y) {
            var isCollision = false;
            for (var i = 0; i < buttons.length; i++) {
                var left = buttons[i].x;
                var right = buttons[i].x + buttons[i].w;
                var top = buttons[i].y
                var bottom = buttons[i].y + buttons[i].h;
                if (right >= x && left <= x && bottom >= y && top <= y) {
                    isCollision = buttons[i];
                }
            }
            return isCollision;
        }
        // define the main screen for the game
        settingScreen = (function (input) {
            var wasButtonDown = false;
            var transitioning = false;
            var buttons = [{x: 120, y: 500, w: 240, h: 200},
                            {x: 480, y: 500, w: 240, h: 200},
                            {x: 840, y: 500, w: 240, h: 200}];

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '172px Tangerine';
                centerText(ctx, 'Settings', 200);

                ctx.font = '86px Tangerine';
                centerText(ctx, 'Please choose the number of teams in this game below', 350);

                ctx.fillStyle = '#ffffff';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                    numberButton(ctx, i + 1, buttons[i]);                
                }
            }

            function numberButton(ctx, text, button) {
                ctx.font = '150px monospace';
                ctx.strokeStyle = 'black';
                ctx.fillStyle = -'#ffffff';
                var measurement = ctx.measureText(text);
                var x = 80 + button.x;
                ctx.fillText(text, x, 650);
                ctx.strokeText(text, x, 650); 
            }

            function update(canvas, elapsed) {
                canvas.addEventListener('click', function(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button == buttons[0]) {
                        transitioning = true;
                        numPlayers = 1;
                        startScreen = gameScreen;
                    } else if (button == buttons[1]) {
                        transitioning = true;
                        numPlayers = 2;
                        startScreen = gameScreen;
                    } else if (button == buttons[2]) {
                        transitioning = true;
                        numPlayers = 3;
                        startScreen = gameScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        // define the start screen
        startScreen = (function (input) {

            var greenVal = 0;
            var direction = 1;
            var transitioning = false;
            var wasButtonDown = false;
            var title = 'What\'s that song?';

            function draw(canvas, ctx) {

                var y = ctx.canvas.height / 2;
                var color = 'rgb(0,' + greenVal + ',0)';

                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '224px Tangerine';
                centerText(ctx, title, y);

                ctx.strokeStyke = 'white';
                ctx.font = '60px Tangerine';
                centerText(ctx, 'A project made by Christine St. Jean, Corey Salmon, and Zach Guthrie', y + 150);

                ctx.fillStyle = color;
                ctx.font = '60px Tangerine';
                centerText(ctx, 'click to begin', y + 250);
            }

            function update() {

                greenVal += 1 * direction;
                if (greenVal > 225) direction = -1;
                if (greenVal < 20) direction = 1;

                var isButtonDown = input.isButtonDown();
                var mouseJustClicked = !isButtonDown && wasButtonDown;

                if (mouseJustClicked && !transitioning) {
                    transitioning = true;
                    startScreen = settingScreen;
                }

                wasButtonDown = isButtonDown;
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        gameScreen = (function (input) {
            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            }
            function update() {
                var isButtonDown = input.isButtonDown();
                var mouseJustClicked = !isButtonDown && wasButtonDown;
                wasButtonDown = isButtonDown;
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));
        beginLoop();
    </script>
</body>
</html>