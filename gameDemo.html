<html>
<head>
    <meta charset="utf-8">
    <link href='https://fonts.googleapis.com/css?family=Tangerine:700' rel='stylesheet' type='text/css'>
    <title>What's That Song? An interactive guessing game made for Professor Loukissas's LMC 2700 Class</title>
    <style>
        * { 
            padding: 0;
            margin: 0;
        }
        canvas {
            background-image: url('https://hdwallpapers.cat/wallpaper_1600x900/vintage_music_paper_firefox_persona_score_1600x900_hd-wallpaper-630445.jpg');
            display: block;
            margin: 0;
            auto;
        }
    </style>
</head>
<body>
    <audio id="bottomC" src="./soundEffects/bottomC.mp3"></audio>
    <canvas id="board"></canvas>
    <script>
        var canvas;
        var surface
        var startScreen;
        var settingScreen;
        var gameScreen;
        var simpleClickSwitch;
        var numPlayers;
        var currentPlayer = 1;
        var players = [{score: 0}];
        var title = 'What\'s that song?';

        function beginLoop() {
            var frameId = 0;
            var lastFrame = Date.now();

            function loop() {
                var thisFrame = Date.now();

                var elapsed = thisFrame - lastFrame;

                frameId = window.requestAnimationFrame(loop);

                startScreen.update(canvas, elapsed);
                startScreen.draw(canvas, surface);

                lastFrame = thisFrame;
            }

            loop();
        }

        canvas = document.querySelector('canvas#board');
        canvas.setAttribute('width', 1200);
        canvas.setAttribute('height', 900);

        surface = canvas.getContext('2d');

        mouseClick = (function (target) {
            var isButtonDown = false;

            target.addEventListener('mousedown', function () {
                isButtonDown = true;
            });
            target.addEventListener('mouseup', function () {
                isButtonDown = false;
            });

            return {
                isButtonDown: function () {
                    return isButtonDown;
                }
            };
        }(document));

        function centerText(ctx, text, y) {
            var measurement = ctx.measureText(text);
            var x = (ctx.canvas.width - measurement.width) / 2;
            ctx.fillText(text, x, y);
            ctx.strokeText(text, x, y);
        }

        function buttonCollision(buttons, x, y) {
            var isCollision = false;
            for (var i = 0; i < buttons.length; i++) {
                var left = buttons[i].x;
                var right = buttons[i].x + buttons[i].w;
                var top = buttons[i].y
                var bottom = buttons[i].y + buttons[i].h;
                if (right >= x && left <= x && bottom >= y && top <= y) {
                    isCollision = buttons[i];
                }
            }
            return isCollision;
        }

        function setNextPlayer() {
            currentPlayer++;
            if (currentPlayer == 4) {
                currentPlayer = 1;
            }
        }

        // define the setting screen for the game
        settingScreen = (function (input) {
            var wasButtonDown = false;
            var transitioning = false;
            var buttons = [{x: 120, y: 500, w: 240, h: 200},
                            {x: 480, y: 500, w: 240, h: 200},
                            {x: 840, y: 500, w: 240, h: 200}];

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '172px Tangerine';
                centerText(ctx, 'Settings', 200);

                ctx.font = '86px Tangerine';
                centerText(ctx, 'Please choose the number of teams in this game below', 350);

                ctx.fillStyle = '#ffffff';
                for (var i = 0; i < buttons.length; i++) {
                    ctx.fillRect(buttons[i].x, buttons[i].y, buttons[i].w, buttons[i].h);
                    numberButton(ctx, i + 1, buttons[i]);                
                }
            }

            function numberButton(ctx, text, button) {
                ctx.font = '150px monospace';
                ctx.strokeStyle = 'black';
                ctx.fillStyle = -'#ffffff';
                var measurement = ctx.measureText(text);
                var x = 80 + button.x;
                ctx.fillText(text, x, 650);
                ctx.strokeText(text, x, 650); 
            }

            function update(canvas, elapsed) {
                canvas.addEventListener('click', function(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button == buttons[0]) {
                        transitioning = true;
                        numPlayers = 1;
                        startScreen = gameScreen;
                    } else if (button == buttons[1]) {
                        transitioning = true;
                        players[1] = {score: 0};
                        numPlayers = 2;
                        startScreen = gameScreen;
                    } else if (button == buttons[2]) {
                        transitioning = true;
                        players[1] = {score: 0};
                        players[2] = {score: 0};
                        numPlayers = 3;
                        startScreen = gameScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        // define the start screen
        startScreen = (function (input) {

            var greenVal = 0;
            var direction = 1;
            var transitioning = false;
            var wasButtonDown = false;


            function draw(canvas, ctx) {

                var y = ctx.canvas.height / 2;
                var color = 'rgb(0,' + greenVal + ',0)';

                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = 'black';
                ctx.font = '224px Tangerine';
                centerText(ctx, title, y);

                ctx.strokeStyke = 'white';
                ctx.font = '60px Tangerine';
                centerText(ctx, 'A project made by Christine St. Jean, Corey Salmon, and Zach Guthrie', y + 150);

                ctx.fillStyle = color;
                ctx.font = '60px Tangerine';
                centerText(ctx, 'click to begin', y + 250);
            }

            function update() {

                greenVal += 1 * direction;
                if (greenVal > 225) direction = -1;
                if (greenVal < 20) direction = 1;

                var isButtonDown = input.isButtonDown();
                var mouseJustClicked = !isButtonDown && wasButtonDown;

                if (mouseJustClicked && !transitioning) {
                    transitioning = true;
                    startScreen = settingScreen;
                }

                wasButtonDown = isButtonDown;
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        gameScreen = (function (input) {
            var buttons = [];

            function draw(canvas, ctx) {
                var easyMeasure = ctx.measureText('Easy');
                var medMeasure = ctx.measureText('Medium');
                var hardMeasure = ctx.measureText('Hard');
                var x1, x2, x3;
                var y1, y2, y3;
                var teamOne, teamTwo, teamThree;

                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#78ff87';
                ctx.strokeStyle = '#000000';
                for (var i = 0; i < 4; i++) {
                    for (var j = 0; j < 6; j++) {
                        var num = (i * 6) + j
                        buttons[num] = {x: 150 + (j * 150), y: 140 + (i * 150), w: 150, h: 150};
                        ctx.fillRect(buttons[num].x, buttons[num].y, buttons[num].w, buttons[num].h);
                        ctx.strokeRect(buttons[num].x, buttons[num].y, buttons[num].w, buttons[num].h);
                    }
                }
                
                ctx.font = '120px Tangerine';
                centerText(ctx, title, 100);

                ctx.fillStyle = '#ffffff';
                labelGrid(ctx, 'Easy', 'Medium', 'Hard');

                ctx.font = '96px Tangerine';
                if (numPlayers == 1) {
                    ctx.fillStyle = 'red';
                    centerText(ctx, 'Team 1: ' + players[0].score, 825);
                } else if (numPlayers == 2) {
                    teamOne = ctx.measureText('Team 1: ' + players[0].score);
                    teamTwo = ctx.measureText('Team 2: ' + players[1].score);
                    x1 = (ctx.canvas.width - teamOne.width) / 4;
                    x2 = ctx.canvas.width / 2 + 300 - teamTwo.width / 2;

                    if (currentPlayer == 1) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 1: ' + players[0].score, x1, 825);
                    ctx.strokeText('Team 1: ' + players[0].score, x1, 825);
                    if (currentPlayer == 2) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 2: ' + players[1].score, x2, 825);
                    ctx.strokeText('Team 2: ' + players[1].score, x2, 825);
                } else {
                    teamOne = ctx.measureText('Team 1: ' + players[0].score);
                    teamThree = ctx.measureText('Team 3: ' + players[2].score);
                    x1 = 225 - (teamOne.width / 2);
                    if (currentPlayer == 2) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    centerText(ctx, 'Team 2: ' + players[1].score, 825);
                    x3 = 825;

                    if (currentPlayer == 1) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 1: ' + players[0].score, x1, 825);
                    ctx.strokeText('Team 1: ' + players[0].score, x1, 825);

                    if (currentPlayer == 3) {
                        ctx.fillStyle = 'red';
                    } else {
                        ctx.fillStyle = 'white';
                    }
                    ctx.fillText('Team 3: ' + players[2].score, x3, 825);
                    ctx.strokeText('Team 3: ' + players[2].score, x3, 825);                    
                }
            }

            function labelGrid(ctx, topLabel, midLabel, botLabel) {
                ctx.font = '50px Tangerine';
                var topMeasure = ctx.measureText(topLabel);
                var midMeasure = ctx.measureText(midLabel);
                var botMeasure = ctx.measureText(botLabel);

                for (var i = 0; i < 6; i++) {
                    ctx.fillText(topLabel, 225 + (i * 150) - (topMeasure.width / 2), 365);
                    ctx.strokeText(topLabel, 225 + (i * 150) - (topMeasure.width / 2), 365);
                    
                    ctx.fillText(midLabel, 225 + (i * 150) - (midMeasure.width / 2), 515);
                    ctx.strokeText(midLabel, 225 + (i * 150) - (midMeasure.width / 2), 515);

                    ctx.fillText(botLabel, 225 + (i * 150) - (botMeasure.width / 2) - 5, 665);
                    ctx.strokeText(botLabel, 225 + (i * 150) - (botMeasure.width / 2) - 5, 665);                
                }

                var measure = ctx.measureText('Classical');
                ctx.fillText('Classical', 225 - (measure.width / 2) - 5, 225);
                ctx.strokeText('Classical', 225 - (measure.width / 2) - 5, 225);

                measure = ctx.measureText('Nursery');
                ctx.fillText('Nursery', 375 - (measure.width / 2), 195);
                ctx.strokeText('Nursery', 375 - (measure.width / 2), 195);

                measure = ctx.measureText('Rhymes');
                ctx.fillText('Rhymes', 375 - (measure.width / 2), 255);
                ctx.strokeText('Rhymes', 375 - (measure.width / 2), 255);

                measure = ctx.measureText('On the');
                ctx.fillText('On the', 525 - (measure.width / 2), 195);
                ctx.strokeText('On the', 525 - (measure.width / 2), 195);

                measure = ctx.measureText('Radio');
                ctx.fillText('Radio', 525 - (measure.width / 2), 255);
                ctx.strokeText('Radio', 525 - (measure.width / 2), 255);

                measure = ctx.measureText('One Hit');
                ctx.fillText('One Hit', 675 - (measure.width / 2), 195);
                ctx.strokeText('One Hit', 675 - (measure.width / 2), 195);

                measure = ctx.measureText('Wonders');
                ctx.fillText('Wonders', 675 - (measure.width / 2), 255);
                ctx.strokeText('Wonders', 675 - (measure.width / 2), 255);

                measure = ctx.measureText('Classic');
                ctx.fillText('Classic', 825 - (measure.width / 2), 195);
                ctx.strokeText('Classic', 825 - (measure.width / 2), 195);

                measure = ctx.measureText('Rock');
                ctx.fillText('Rock', 825 - (measure.width / 2), 255);
                ctx.strokeText('Rock', 825 - (measure.width / 2), 255);

                measure = ctx.measureText('Game');
                ctx.fillText('Game', 975 - (measure.width / 2), 195);
                ctx.strokeText('Game', 975 - (measure.width / 2), 195);

                measure = ctx.measureText('Music');
                ctx.fillText('Music', 975 - (measure.width / 2), 255);
                ctx.strokeText('Music', 975 - (measure.width / 2), 255);
            }
            function update() {
                canvas.addEventListener('click', function(e) {
                    var button = buttonCollision(buttons, e.offsetX, e.offsetY);
                    if (button !== null && button.y > 150) {
                        transitioning = true;
                        currentTile = button;
                        startScreen = pianoScreen;
                    }
                }, false);
            }

            return {
                draw: draw,
                update: update
            };
        }(mouseClick));

        pianoScreen = (function (input) {
            var currentNote;
            var wasButtonDown = false;
            var sounds = {
                65: 'bottomC',
                87: 'dFlat',
                83: 'D',
                69: 'eFlat',
                68: 'E',
                70: 'F',
                84: 'gFlat',
                71: 'G',
                89: 'aFlat',
                72: 'A',
                85: 'bFlat',
                74: 'B',
                75: 'topC',
                79: 'upperDflat',
                76: 'upperD',
                80: 'upperEflat',
                186: 'upperE',
                222: 'upperF'
            };

            function draw(canvas, ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.strokeStyle = 'black';
                drawKeys(ctx);
            }

            function update(ctx) {
                document.onkeydown = function (e) {
                    var soundId = sounds[e.keyCode];
                    if (soundId) {
                        var sound = new Audio("./soundEffects/" + sounds[e.keyCode] + ".mp3");
                        sound.play();
                        currentNote = sounds[e.keyCode];
                        drawKeys(ctx);
                    }
                }
                document.onkeyup = function (e) {
                    currentNote = null;
                }
            }

            function drawKeys(ctx) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                // Bottom C
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(105, 150);
                ctx.lineTo(105, 750);
                ctx.lineTo(195, 750);
                ctx.lineTo(195, 450);
                ctx.lineTo(150, 450);
                ctx.lineTo(150, 150);
                ctx.lineTo(105, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'bottomC') {
                    ctx.fillStyle = '#b22937';
                }
                ctx.stroke();
                ctx.fill();

                // Lower D
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(225, 150);
                ctx.lineTo(255, 150);
                ctx.lineTo(255, 450);
                ctx.lineTo(285, 450);
                ctx.lineTo(285, 750);
                ctx.lineTo(195, 750);
                ctx.lineTo(195, 450);
                ctx.lineTo(225, 450);
                ctx.lineTo(225, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'D') {
                    ctx.fillStyle = '#de5003';
                }
                ctx.stroke();
                ctx.fill();
                
                // Lower E
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(330, 150);
                ctx.lineTo(375, 150);
                ctx.lineTo(375, 750);
                ctx.lineTo(285, 750);
                ctx.lineTo(285, 450);
                ctx.lineTo(330, 450);
                ctx.lineTo(330, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'E') {
                    ctx.fillStyle = '#efce10';
                }
                ctx.stroke();
                ctx.fill();

                // Lower F
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(375, 150);
                ctx.lineTo(375, 750);
                ctx.lineTo(465, 750);
                ctx.lineTo(465, 450);
                ctx.lineTo(420, 450);
                ctx.lineTo(420, 150);
                ctx.lineTo(375, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'F') {
                    ctx.fillStyle = '#acd62a';
                }
                ctx.stroke();
                ctx.fill();
                // G
                
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(495, 150);
                ctx.lineTo(525, 150);
                ctx.lineTo(525, 450);
                ctx.lineTo(555, 450);
                ctx.lineTo(555, 750);
                ctx.lineTo(465, 750);
                ctx.lineTo(465, 450);
                ctx.lineTo(495, 450);
                ctx.lineTo(495, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'G') {
                    ctx.fillStyle = '#228b22';
                }
                ctx.stroke();
                ctx.fill();

                // A
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(585, 150);
                ctx.lineTo(615, 150);
                ctx.lineTo(615, 450);
                ctx.lineTo(645, 450);
                ctx.lineTo(645, 750);
                ctx.lineTo(555, 750);
                ctx.lineTo(555, 450);
                ctx.lineTo(585, 450);
                ctx.lineTo(585, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'A') {
                    ctx.fillStyle = '#93bde7';
                }
                ctx.stroke();
                ctx.fill();

                // B
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(690, 150);
                ctx.lineTo(735, 150);
                ctx.lineTo(735, 750);
                ctx.lineTo(645, 750);
                ctx.lineTo(645, 450);
                ctx.lineTo(690, 450);
                ctx.lineTo(690, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'B') {
                    ctx.fillStyle = '#575597';
                }
                ctx.stroke();
                ctx.fill();

                // Top C
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(735, 150);
                ctx.lineTo(735, 750);
                ctx.lineTo(825, 750);
                ctx.lineTo(825, 450);
                ctx.lineTo(780, 450);
                ctx.lineTo(780, 150);
                ctx.lineTo(735, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'topC') {
                    ctx.fillStyle = '#1f1d6d';
                }
                ctx.stroke();
                ctx.fill();

                // Upper D
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(855, 150);
                ctx.lineTo(885, 150);
                ctx.lineTo(885, 450);
                ctx.lineTo(915, 450);
                ctx.lineTo(915, 750);
                ctx.lineTo(825, 750);
                ctx.lineTo(825, 450);
                ctx.lineTo(855, 450);
                ctx.moveTo(855, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'upperD') {
                    ctx.fillStyle = '#a670b8';
                }
                ctx.stroke();
                ctx.fill();

                // Upper E
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(960, 150);
                ctx.lineTo(1005, 150);
                ctx.lineTo(1005, 750);
                ctx.lineTo(915, 750);
                ctx.lineTo(915, 450);
                ctx.lineTo(960, 450);
                ctx.lineTo(960, 150);
                ctx.closePath();
                if (currentNote && currentNote === 'upperE') {
                    ctx.fillStyle = '#a650a0';
                }
                ctx.stroke();
                ctx.fill();

                // Upper F
                if (currentNote && currentNote === 'upperF') {
                    ctx.fillStyle = '#a2395b';
                } else {
                    ctx.fillStyle = 'white';
                }
                ctx.fillRect(1005, 150, 90, 600);
                ctx.strokeRect(1005, 150, 90, 600);

                // Lower C#/D flat
                if (currentNote && currentNote === 'dFlat') {
                    ctx.fillStyle = '#c11c17';
                } else {
                    ctx.fillStyle = 'black';
                }
                ctx.fillRect(150, 150, 75, 300);

                // Lower D#/E flat
                if (currentNote && currentNote === 'eFlat') {
                    ctx.fillStyle = '#e27a1d';
                } else {
                    ctx.fillStyle = 'black';
                }
                ctx.fillRect(255, 150, 75, 300);
                // F#/G flat
                if (currentNote && currentNote === 'gFlat') {
                    ctx.fillStyle = '#4ca82b';
                } else {
                    ctx.fillStyle = 'black';
                }
                ctx.fillRect(420, 150, 75, 300);
                // G#/A flat
                if (currentNote && currentNote === 'aFlat') {
                    ctx.fillStyle = '#20b2aa';
                } else {
                    ctx.fillStyle = 'black';
                };
                ctx.fillRect(525, 150, 60, 300);
                // A#/B Flat
                if (currentNote && currentNote === 'bFlat') {
                    ctx.fillStyle = '#6f6da7';
                } else {
                    ctx.fillStyle = 'black';
                }
                ctx.fillRect(615, 150, 75, 300);
                // Upper C#/D flat
                if (currentNote && currentNote === 'upperDflat') {
                    ctx.fillStyle = '#502e72';
                } else {
                    ctx.fillStyle = 'black';
                }
                ctx.fillRect(780, 150, 75, 300);
                // Upper D#/E flat
                if (currentNote && currentNote === 'upperEflat') {
                    ctx.fillStyle = '#a63570';
                } else {
                    ctx.fillStyle = 'black';
                }
                ctx.fillRect(885, 150, 75, 300);
            }
            return {
                draw: draw,
                update: update
            };
        }(mouseClick));
        beginLoop();
    </script>
</body>
</html>